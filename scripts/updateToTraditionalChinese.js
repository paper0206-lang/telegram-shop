const fs = require('fs').promises;
const path = require('path');

// ç°¡é«”åˆ°ç¹é«”çš„å­—å…¸æ˜ å°„
const s2tDict = {
  // åŸºæœ¬å­—è©
  'æ¬¢è¿': 'æ­¡è¿',
  'è´­ç‰©': 'è³¼ç‰©',
  'æµè§ˆ': 'ç€è¦½',
  'æŸ¥çœ‹': 'æŸ¥çœ‹',
  'è·å–': 'ç²å–',
  'å¸®åŠ©': 'å¹«åŠ©',
  'æˆ‘ä»¬': 'æˆ‘å€‘',
  'æ¥å—': 'æ¥å—',
  'æ”¯ä»˜': 'æ”¯ä»˜',
  'ä½¿ç”¨': 'ä½¿ç”¨',
  'å‘½ä»¤': 'æŒ‡ä»¤',
  'å¼€å§‹': 'é–‹å§‹',
  'å•†å“': 'å•†å“',
  'è´­ç‰©è½¦': 'è³¼ç‰©è»Š',
  'ç”¨æˆ·': 'ç”¨æˆ¶',
  'æš‚æ— ': 'æš«ç„¡',
  'å¯å”®': 'å¯å”®',
  'æ¥åˆ°': 'ä¾†åˆ°',
  'é€‰æ‹©': 'é¸æ“‡',
  'æƒ³è¦': 'æƒ³è¦',
  'åˆ†ç±»': 'åˆ†é¡',
  'åŒæ—¶': 'åŒæ™‚',
  'æ˜¾ç¤º': 'é¡¯ç¤º',
  'ç²¾é€‰': 'ç²¾é¸',
  'è·å–': 'ç²å–',
  'ä¿¡æ¯': 'è¨Šæ¯',
  'å‡ºé”™': 'å‡ºéŒ¯',
  'è¯·': 'è«‹',
  'ç¨å': 'ç¨å¾Œ',
  'é‡è¯•': 'é‡è©¦',
  'é”™è¯¯': 'éŒ¯èª¤',
  'è½¦': 'è»Š',
  'è´­': 'è³¼',
  'æµ': 'ç€',
  'è§ˆ': 'è¦½',
  'è·': 'ç²',
  'è´§': 'è²¨',
  'å¸': 'å¹£',
  'åº”': 'æ‡‰',
  'å†…': 'å…§',
  'ä¹°': 'è²·',
  'éšœ': 'éšœ',
  'è”': 'è¯',
  'è¯¢': 'è©¢',
  'é—®': 'å•',
  'åŠ¡': 'å‹™',
  'å•': 'å–®',
  'è¯¦': 'è©³',
  'æƒ…': 'æƒ…',
  'æ²¡': 'æ²’',
  'åˆ›': 'å‰µ',
  'å»º': 'å»º',
  'å‘': 'ç™¼',
  'ç¥¨': 'ç¥¨',
  'è®¢': 'è¨‚',
  'æ€»': 'ç¸½',
  'ä»·': 'åƒ¹',
  'å­˜': 'å­˜',
  'å‚¨': 'å„²',
  'å¤„': 'è™•',
  'ç†': 'ç†',
  'è¿‡': 'é',
  'æœŸ': 'æœŸ',
  'éªŒ': 'é©—',
  'è¯': 'è­‰',
  'è´¥': 'æ•—',
  'è¯•': 'è©¦',
  'è¿™': 'é€™',
  'é‡Œ': 'è£¡',
  'é¢': 'é¡',
  'å¤–': 'å¤–',
  'æ£€': 'æª¢',
  'åº“': 'åº«',
  'å‘': 'ç™¼',
  'é€': 'é€',
  'æ¸…': 'æ¸…',
  'è®°': 'è¨˜',
  'å½•': 'éŒ„',
  'æ›´': 'æ›´',
  'æ–°': 'æ–°',
  'ä¿': 'ä¿',
  'ç¡®': 'ç¢º',
  'è®¤': 'èª',
  'é‚®': 'éƒµ',
  'ä»¶': 'ä»¶',
  'è”': 'è¯',
  'ç³»': 'ç¹«',
  'æ—¶': 'æ™‚',
  'é—´': 'é–“',
  'è°¢': 'è¬',
  'æ‚¨': 'æ‚¨',
  'æ•°': 'æ•¸',
  'é‡': 'é‡',
  'ç§': 'ç¨®',
  'äº¤': 'äº¤',
  'æ˜“': 'æ˜“',
  'å·²': 'å·²',
  'æ„Ÿ': 'æ„Ÿ',
  'é‚®': 'éƒµ',
  'å¦‚': 'å¦‚',
  'æœ‰': 'æœ‰',
  'ç–‘': 'ç–‘',
  'é—®': 'å•',
  'è”': 'è¯',
  'ç³»': 'ç¹«',
  'å®¢': 'å®¢',
  'æœ': 'æœ',
  'æ¸…': 'æ¸…',
  'ç†': 'ç†',
  'æœŸ': 'æœŸ',
  'çš„': 'çš„',
  'å¾…': 'å¾…',
  'ä»˜': 'ä»˜',
  'æ¬¾': 'æ¬¾'
};

// çŸ­èªæ˜ å°„
const phraseDict = {
  'è´­ç‰©è½¦': 'è³¼ç‰©è»Š',
  'æµè§ˆå•†å“': 'ç€è¦½å•†å“',
  'æŸ¥çœ‹è´­ç‰©è½¦': 'æŸ¥çœ‹è³¼ç‰©è»Š',
  'è·å–å¸®åŠ©': 'ç²å–å¹«åŠ©',
  'æˆ‘ä»¬æ¥å—': 'æˆ‘å€‘æ¥å—',
  'å¼€å§‹è´­ç‰©': 'é–‹å§‹è³¼ç‰©',
  'ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤': 'ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤',
  'æš‚æ— å•†å“å¯å”®': 'æš«ç„¡å•†å“å¯å”®',
  'æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„å•†åº—': 'æ­¡è¿ä¾†åˆ°æˆ‘å€‘çš„å•†åº—',
  'è¯·é€‰æ‹©æ‚¨æƒ³è¦æµè§ˆçš„å•†å“åˆ†ç±»': 'è«‹é¸æ“‡æ‚¨æƒ³è¦ç€è¦½çš„å•†å“åˆ†é¡',
  'åŒæ—¶æ˜¾ç¤ºç²¾é€‰å•†å“': 'åŒæ™‚é¡¯ç¤ºç²¾é¸å•†å“',
  'ç²¾é€‰å•†å“': 'ç²¾é¸å•†å“',
  'è·å–å•†å“ä¿¡æ¯æ—¶å‡ºé”™': 'ç²å–å•†å“è¨Šæ¯æ™‚å‡ºéŒ¯',
  'è¯·ç¨åé‡è¯•': 'è«‹ç¨å¾Œé‡è©¦',
  'è´­ç‰©å‘½ä»¤': 'è³¼ç‰©æŒ‡ä»¤',
  'æµè§ˆæ‰€æœ‰å•†å“': 'ç€è¦½æ‰€æœ‰å•†å“',
  'å›åˆ°ä¸»èœå•': 'å›åˆ°ä¸»é¸å–®',
  'æ”¯ä»˜æ–¹å¼': 'æ”¯ä»˜æ–¹å¼',
  'æˆ‘ä»¬ä½¿ç”¨': 'æˆ‘å€‘ä½¿ç”¨',
  'ä½œä¸ºæ”¯ä»˜è´§å¸': 'ä½œç‚ºæ”¯ä»˜è²¨å¹£',
  'æ‚¨å¯ä»¥é€šè¿‡åº”ç”¨å†…è´­ä¹°è·å¾—': 'æ‚¨å¯ä»¥é€šéæ‡‰ç”¨å…§è³¼è²·ç²å¾—',
  'æ”¯ä»˜å®‰å…¨ç”±': 'æ”¯ä»˜å®‰å…¨ç”±',
  'ä¿éšœ': 'ä¿éšœ',
  'éœ€è¦å¸®åŠ©': 'éœ€è¦å¹«åŠ©',
  'è¯·è”ç³»å®¢æœè·å–æ”¯æŒ': 'è«‹è¯ç¹«å®¢æœç²å–æ”¯æŒ'
};

function convertToTraditionalChinese(text) {
  let result = text;
  
  // å…ˆæ›¿æ›çŸ­èª
  for (const [simplified, traditional] of Object.entries(phraseDict)) {
    result = result.replace(new RegExp(simplified, 'g'), traditional);
  }
  
  // å†æ›¿æ›å–®å­—
  for (const [simplified, traditional] of Object.entries(s2tDict)) {
    result = result.replace(new RegExp(simplified, 'g'), traditional);
  }
  
  return result;
}

async function updateFile(filePath) {
  try {
    const content = await fs.readFile(filePath, 'utf8');
    const updatedContent = convertToTraditionalChinese(content);
    
    if (content !== updatedContent) {
      await fs.writeFile(filePath, updatedContent, 'utf8');
      console.log(`âœ… å·²æ›´æ–°: ${filePath}`);
      return true;
    } else {
      console.log(`â­ï¸ è·³é: ${filePath} (ç„¡éœ€æ›´æ–°)`);
      return false;
    }
  } catch (error) {
    console.error(`âŒ æ›´æ–°å¤±æ•—: ${filePath}`, error.message);
    return false;
  }
}

async function updateAllFiles() {
  const filesToUpdate = [
    'src/handlers/MessageHandler.js',
    'src/handlers/CallbackHandler.js',
    'src/utils/UIHelper.js',
    'data/products.json'
  ];
  
  let updatedCount = 0;
  
  for (const file of filesToUpdate) {
    const filePath = path.join(__dirname, '..', file);
    const updated = await updateFile(filePath);
    if (updated) updatedCount++;
  }
  
  console.log(`\nğŸ‰ è½‰æ›å®Œæˆï¼æ›´æ–°äº† ${updatedCount} å€‹æª”æ¡ˆ`);
}

// å¦‚æœç›´æ¥é‹è¡Œæ­¤è…³æœ¬
if (require.main === module) {
  updateAllFiles();
}

module.exports = { convertToTraditionalChinese, updateAllFiles };